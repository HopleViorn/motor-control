# Modbus 实时示波器使用说明

## 概述
本项目提供了两个版本的Modbus实时示波器：
1. **Matplotlib版本** - 传统桌面界面，兼容性好
2. **Web版本** - 高性能网页界面，现代化UI

## 快速开始

### 方法1：使用选择菜单
```bash
python modbus_oscilloscope.py
```
运行后会出现选择菜单，可以选择使用哪个版本。

### 方法2：直接启动对应版本

#### 启动Matplotlib版本
```bash
python modbus_oscilloscope.py
# 选择 1
```

#### 启动Web版本
```bash
python modbus_web_oscilloscope.py
```

## 依赖安装

### 基础依赖
```bash
pip install matplotlib numpy pymodbus pyserial
```

### Web版本额外依赖
```bash
pip install -r requirements_web.txt
```
或者手动安装：
```bash
pip install dash plotly dash-bootstrap-components
```

## 功能对比

| 功能 | Matplotlib版本 | Web版本 |
|------|----------------|---------|
| 性能 | 中等 | 高 |
| 数据点数 | 200点 | 300点 |
| 界面 | 传统桌面 | 现代网页 |
| 交互性 | 基础 | 丰富 |
| 部署 | 本地运行 | 可远程访问 |
| 启动速度 | 快 | 中等 |
| 资源占用 | 低 | 中等 |

## Web版本特色功能

### 连接设置面板
- **串口选择**: 下拉菜单选择可用串口
- **刷新串口**: 更新串口列表
- **连接/断开**: 手动控制串口连接状态

### 数据采集控制
- **开始采集**: 开始数据采集（需先连接串口）
- **停止采集**: 停止数据采集（保持连接）
- **清除数据**: 清空当前显示的所有数据

### 设备控制面板
- **开机按钮**: 发送开机指令 (01 06 00 03 00 01)
- **关机按钮**: 发送关机指令 (01 06 00 03 00 00)
- **调速控制**: 输入转速值(0-30000 RPM)并设置

### 状态监控
- 实时显示连接状态
- 显示当前数据点数量
- 操作消息反馈
- 颜色编码状态指示

### 图表功能
- 多子图显示不同寄存器
- 交互式缩放和平移
- 悬停显示详细数值
- 自动滚动时间窗口

## 配置参数

### 共同参数
```python
START_ADDRESS = 50    # 起始寄存器地址
COUNT = 3            # 读取寄存器数量
UPDATE_INTERVAL_MS = 100  # 更新间隔（毫秒）
```

### Matplotlib版本专有
```python
MAX_POINTS = 200     # 最大显示点数
TIME_WINDOW = 20     # 时间窗口（秒）
```

### Web版本专有
```python
MAX_POINTS = 300     # 最大显示点数
TIME_WINDOW = 30     # 时间窗口（秒）
```

## 使用建议

### 选择Matplotlib版本的情况
- 首次使用或测试
- 系统资源有限
- 不需要远程访问
- 偏好传统界面

### 选择Web版本的情况
- 需要更好的性能
- 喜欢现代化界面
- 需要更多数据点
- 可能需要远程访问
- 多人同时查看

## 故障排除

### 常见问题

1. **无法连接Modbus设备**
   - 检查串口连接
   - 确认设备地址和波特率
   - 检查串口是否被其他程序占用

2. **Web版本无法启动**
   - 检查是否安装了dash和plotly
   - 运行：`pip install dash plotly`

3. **数据显示异常**
   - 检查寄存器地址配置
   - 确认数据类型设置
   - 查看控制台错误信息

4. **性能问题**
   - 减少更新频率（增加UPDATE_INTERVAL_MS）
   - 减少显示点数（减少MAX_POINTS）
   - 使用Web版本获得更好性能

## 技术支持

如果遇到问题，请检查：
1. Python版本（建议3.7+）
2. 依赖库版本
3. 硬件连接
4. 防火墙设置（Web版本）

## 更新日志

### v2.0
- 新增Web版本示波器
- 改进用户界面
- 提升性能表现
- 增加选择菜单

### v1.0
- 基础Matplotlib版本
- 基本数据采集功能 